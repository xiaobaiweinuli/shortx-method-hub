<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ShortX Method Hub - æ–¹æ³•æœç´¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  <style>
    body { font-family: system-ui, sans-serif; }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors">

<div class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-10">
    <div class="max-w-5xl mx-auto px-4 py-5 flex justify-between items-center">
      <h1 class="text-2xl font-bold">ShortX Method Hub</h1>
      <div class="flex items-center gap-4">
        <a href="/shortx.html" class="text-blue-600 dark:text-blue-400 underline">ShortX ä¸“ç”¨</a>
        <a href="/admin.html" class="text-indigo-600 dark:text-indigo-400 underline">ç®¡ç†åå°</a>
        <!-- æš—è‰²åˆ‡æ¢æŒ‰é’® -->
        <button id="themeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
          <span class="dark:hidden">ğŸŒ™</span>
          <span class="hidden dark:inline">â˜€ï¸</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 max-w-5xl mx-auto w-full px-4 py-8">
    <input
      id="searchInput"
      type="text"
      placeholder="æœç´¢æ ‡é¢˜æˆ– #tag..."
      class="w-full px-6 py-4 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg mb-8"
      onkeyup="debouncedSearch()"
    />

    <div id="methodList" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-8">
      <div class="text-center text-gray-500 col-span-full">åŠ è½½ä¸­...</div>
    </div>

    <!-- åˆ†é¡µ -->
    <div id="pagination" class="flex justify-center gap-3"></div>
  </main>

  <!-- Footer -->
  <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-6 mt-auto">
    <div class="max-w-5xl mx-auto px-4 text-center text-sm text-gray-600 dark:text-gray-400">
      ShortX Method Hub Â© 2025
    </div>
  </footer>
</div>

<!-- è¯¦æƒ…æ¨¡æ€ -->
<div id="detailModal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50 p-4">
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-full overflow-y-auto">
    <div class="sticky top-0 bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-6 flex justify-between items-center">
      <h2 id="detailTitle" class="text-2xl font-bold"></h2>
      <button onclick="closeModal()" class="text-3xl text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">&times;</button>
    </div>
    <div class="p-6">
      <div id="detailTags" class="mb-6"></div>
      <pre id="detailCode" class="bg-gray-100 dark:bg-gray-900 p-6 rounded-xl overflow-x-auto text-sm mb-6"><code></code></pre>
      <button id="copyBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl text-lg font-medium">
        ğŸ“‹ å¤åˆ¶å®Œæ•´ä»£ç 
      </button>
    </div>
  </div>
</div>

<script>
  let allMethods = [];
  let currentPage = 1;
  const PAGE_SIZE = 20;

  // ä¸»é¢˜åˆ‡æ¢
  const themeToggle = document.getElementById('themeToggle');
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

  if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
    document.documentElement.classList.add('dark');
  }

  themeToggle.onclick = () => {
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
  };

  // åŠ è½½æ–¹æ³•
  async function loadMethods() {
    try {
      const res = await fetch('/api/methods');
      allMethods = await res.json();
      renderPage(1);
    } catch (e) {
      document.getElementById('methodList').innerHTML = '<p class="text-red-500 col-span-full text-center">åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ</p>';
    }
  }

  // æ¸²æŸ“é¡µé¢
  function renderPage(page) {
    currentPage = page;
    const start = (page - 1) * PAGE_SIZE;
    const end = start + PAGE_SIZE;
    const pageMethods = allMethods.slice(start, end);

    const container = document.getElementById('methodList');
    if (pageMethods.length === 0) {
      container.innerHTML = '<p class="text-gray-500 col-span-full text-center text-xl">æš‚æ— æ–¹æ³•</p>';
      document.getElementById('pagination').innerHTML = '';
      return;
    }

    container.innerHTML = pageMethods.map(m => `
      <div onclick='showDetail(${m.id})' class="cursor-pointer bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-xl transition p-6">
        <div class="flex justify-between items-start mb-3">
          <h3 class="font-semibold text-lg line-clamp-2 flex-1 mr-3">${escapeHtml(m.title)}</h3>
          ${m.verified ? '<span class="bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 text-xs px-2 py-1 rounded">å·²éªŒè¯</span>' : ''}
        </div>
        <div class="text-sm text-gray-600 dark:text-gray-400 mb-4">
          \( {m.tags ? m.tags.split(',').map(t => `<span class="inline-block bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 px-2 py-1 rounded mr-1 mb-1 text-xs"># \){t}</span>`).join('') : '<span class="text-gray-400">æ— æ ‡ç­¾</span>'}
        </div>
        <pre class="bg-gray-100 dark:bg-gray-900 p-4 rounded-lg overflow-x-auto text-xs"><code>\( {escapeHtml(m.code.slice(0, 250))} \){m.code.length > 250 ? '...' : ''}</code></pre>
      </div>
    `).join('');

    renderPagination(Math.ceil(allMethods.length / PAGE_SIZE));
  }

  // åˆ†é¡µ
  function renderPagination(totalPages) {
    const pagination = document.getElementById('pagination');
    let html = '';
    for (let i = 1; i <= totalPages; i++) {
      html += `<button onclick='renderPage(${i})' class="px-4 py-2 rounded \( {i === currentPage ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600'}"> \){i}</button>`;
    }
    pagination.innerHTML = html;
  }

  // é˜²æŠ–æœç´¢
  function debouncedSearch() {
    clearTimeout(window.searchTimeout);
    window.searchTimeout = setTimeout(search, 300);
  }

  function search() {
    const q = document.getElementById('searchInput').value.trim().toLowerCase();
    if (!q) {
      renderPage(1);
      return;
    }
    const filtered = allMethods.filter(m =>
      m.title.toLowerCase().includes(q) ||
      (m.tags && m.tags.toLowerCase().includes(q))
    );
    allMethods = filtered;
    renderPage(1);
  }

  // æ˜¾ç¤ºè¯¦æƒ…
  function showDetail(id) {
    const method = allMethods.find(m => m.id === id);
    if (!method) return;

    document.getElementById('detailTitle').textContent = method.title;
    document.getElementById('detailTags').innerHTML = method.tags
      ? method.tags.split(',').map(t => `<span class="inline-block bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200 px-3 py-1 rounded-full mr-2">#${t}</span>`).join('')
      : '<span class="text-gray-500">æ— æ ‡ç­¾</span>';

    document.querySelector('#detailCode code').textContent = method.code;

    document.getElementById('copyBtn').onclick = () => {
      navigator.clipboard.writeText(method.code).then(() => alert('âœ… å·²å¤åˆ¶å®Œæ•´ä»£ç ï¼'));
    };

    document.getElementById('detailModal').classList.remove('hidden');
  }

  function closeModal() {
    document.getElementById('detailModal').classList.add('hidden');
  }

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // å¯åŠ¨
  loadMethods();
</script>

</body>
</html>